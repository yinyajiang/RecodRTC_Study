<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .quick-active {
            border: 1px solid #4CAF50;
        }

        .display-none {
            display: none;
        }

        .bg {
            background: white;
        }




        @keyframes borderBlink {

            0%,
            100% {
                border-color: rgba(255, 0, 0, 0.2);
            }

            50% {
                border-color: rgba(255, 0, 0, 1);
            }
        }

        .blinking-border {
            border-color: red;
            animation: borderBlink 0.7s ease-in-out 2;
            animation-fill-mode: forwards;
        }
    </style>
</head>

<body>

    <div>quick start</div>
    <div id="quick-btn-list" class="border-style">
        <button id="btn-quick-screen">Screen</button>
        <button id="btn-quick-camera">Camera</button>
        <button id="btn-quick-screen-camera">Screen + Camera</button>
        <div id="btn-start"><a>Start Recording</a></div>
    </div>

    <div>custom devices <a href="#btn-start">start recording</a></div>

    <div id="custom-devices-btn-list" class="border-style">
        <input type="checkbox" id="checkbox-camera" checked> Camera</checkbox>
        <input type="checkbox" id="checkbox-microphone"> Microphone</input>
        <input type="checkbox" id="checkbox-screen">Screen</input>
        <input type="checkbox" id="checkbox-system-audio"> System Audio</input>
    </div>
    <div>advance setting</div>
    <input type="range" id="input-speak-time-out" min="0" max="30" step="1" value="0">监听声音</input> <span
        id="display-speak-timeout-value"></span>

    <script>
        function clickElement(element) {
            let event = document.createEvent('Event');
            event.initEvent('click', true, true);
            element.dispatchEvent(event);
        }
        function startBlinkingBorder(selector) {
            const element = document.querySelector(selector);
            if (!element) {
                console.error(`no element found with selector: ${selector}`);
                return;
            }
            element.classList.remove('blinking-border');
            element.classList.add('blinking-border');
            element.addEventListener('animationend', function () {
                element.classList.remove('blinking-border');
            }, { once: true });
        }

        function settingListenAndInit() {
            const cameraCheckbox = document.querySelector('#checkbox-camera');
            const microphoneCheckbox = document.querySelector('#checkbox-microphone');
            const screenCheckbox = document.querySelector('#checkbox-screen');
            const systemAudioCheckbox = document.querySelector('#checkbox-system-audio');

            const quickScreenBtn = document.querySelector('#btn-quick-screen');
            const quickCameraBtn = document.querySelector('#btn-quick-camera');
            const quickScreenCameraBtn = document.querySelector('#btn-quick-screen-camera');

            const inputSpeakTimeout = document.querySelector('#input-speak-time-out');
            const displayTimeoutValue = document.querySelector("#display-speak-timeout-value");

            function removeAllQuickActive() {
                quickScreenBtn.classList.remove('quick-active');
                quickCameraBtn.classList.remove('quick-active');
                quickScreenCameraBtn.classList.remove('quick-active');
            }


            /* 快速配置 */
            quickScreenBtn.addEventListener('click', () => {
                quickScreenBtn.classList.add('quick-active');
                quickCameraBtn.classList.remove('quick-active');
                quickScreenCameraBtn.classList.remove('quick-active');

                screenCheckbox.checked = true;
                cameraCheckbox.checked = false;
                microphoneCheckbox.checked = false;
                systemAudioCheckbox.checked = false;

                resetAdvancedSetting();
            })
            quickCameraBtn.addEventListener('click', () => {
                quickCameraBtn.classList.add('quick-active');
                quickScreenBtn.classList.remove('quick-active');
                quickScreenCameraBtn.classList.remove('quick-active');

                cameraCheckbox.checked = true;
                microphoneCheckbox.checked = true;
                screenCheckbox.checked = false;
                systemAudioCheckbox.checked = false;

                resetAdvancedSetting();
            })
            quickScreenCameraBtn.addEventListener('click', () => {
                quickScreenCameraBtn.classList.add('quick-active');
                quickScreenBtn.classList.remove('quick-active');
                quickCameraBtn.classList.remove('quick-active');

                screenCheckbox.checked = true;
                cameraCheckbox.checked = true;
                microphoneCheckbox.checked = true;
                systemAudioCheckbox.checked = false;

                resetAdvancedSetting();
            })

            screenCheckbox.addEventListener('change', () => {
                removeAllQuickActive();
            })
            cameraCheckbox.addEventListener('change', () => {
                removeAllQuickActive();
            })
            microphoneCheckbox.addEventListener('change', () => {
                removeAllQuickActive();
            })
            systemAudioCheckbox.addEventListener('change', () => {
                removeAllQuickActive();
            })


            /* 高级设置 */
            function resetAdvancedSetting() {
                displayTimeoutValue.innerHTML = 0;
                inputSpeakTimeout.value = 0;
            }

            microphoneCheckbox.addEventListener('change', () => {
                if (!microphoneCheckbox.checked) {
                    displayTimeoutValue.innerHTML = 0;
                    inputSpeakTimeout.value = 0;
                }
            })
            inputSpeakTimeout.addEventListener('input', () => {
                if (inputSpeakTimeout.value > 0) {
                    if (!systemAudioCheckbox.checked) {
                        microphoneCheckbox.checked = true;
                    }
                } else {
                    if (!systemAudioCheckbox.checked) {
                        microphoneCheckbox.checked = false;
                    }
                }
                displayTimeoutValue.innerHTML = inputSpeakTimeout.value;
            })
            // 选中默认配置
            setTimeout(() => clickElement(quickScreenBtn), 500);


            const startFunc = (event) => {
                event.preventDefault();

                localStorage.setItem('microphone', microphoneCheckbox.checked ? '1' : '0');
                localStorage.setItem('screen', screenCheckbox.checked ? '1' : '0');
                localStorage.setItem('camera', cameraCheckbox.checked ? '1' : '0');
                localStorage.setItem('systemAudio', systemAudioCheckbox.checked ? '1' : '0');
                localStorage.setItem('speakTimeout', inputSpeakTimeout.value + '');

                if (!microphoneCheckbox.checked && !screenCheckbox.checked && !cameraCheckbox.checked && !systemAudioCheckbox.checked) {
                    startBlinkingBorder('#quick-btn-list');
                    startBlinkingBorder('#custom-devices-btn-list');
                    return;
                }
                window.location.href = "/online-recorder/app";
            }
            const starBtn = document.querySelector('#btn-start a');
            starBtn.addEventListener('click', startFunc)
            const startBtn2 = document.querySelector('a[href="#btn-start"]');
            if (startBtn2) {
                startBtn2.addEventListener('click', startFunc);
            }
        }
        window.addEventListener('DOMContentLoaded', () => {
            settingListenAndInit();
        });
    </script>
</body>

</html>